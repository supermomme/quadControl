<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0">
    <title>Feathers Chat</title>
  </head>
  <body>
    <div id="controls"></div>
    <script src="bower_components/socket.io-client/socket.io.js"></script>
    <script src="bower_components/feathers-client/dist/feathers.js"></script>
    <script type="text/javascript">
    'use strict';
  var socket = io('http://localhost:3030');
  var app = feathers()
    .configure(feathers.hooks())
    .configure(feathers.socketio(socket))
    .configure(feathers.authentication({ storage: window.localStorage }));
  var userService = app.service('users');
  var controlService = app.service('controls')
  function getThrottle() {
    return controlService.find({query:{type:"thro"}}).then((res) => res.data[0]);
  }

  app.authenticate({
    type: 'local',
    'email': 'momme@juergensen.me',
    'password': 'test'
  }).then(function(result){
    return controlService.find()
    .then((res) => res.data)
    .then((controls) => {
      let controlsElement = document.getElementById('controls');
      for (var i = 0; i < controls.length; i++) {
        let control = controls[i];
        let itemELement = document.createElement('input')
        itemELement.value = control.value;
        itemELement.type = 'number';
        itemELement.addEventListener('keyup', () => {
          controlService.patch(control.id, {value:itemELement.value})
        })
        controlService.on('patched',(res) => {
          if(res.id == control.id) itemELement.value = res.value;
        })
        controlsElement.appendChild(itemELement);
      }
    })


  }).catch(function(error){
    console.error('Error authenticating!', error);
  });
/*
  userService.create({
    email:"momme@juergensen.me",
    password:"test"
  })
  .then((res) => console.log(res))
  .catch((err) => console.log(err))*/

</script>
  </body>
</html>
